(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{10:function(e,t,n){e.exports=n(15)},15:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),i=n(8),o=n.n(i),l=n(9),r=n(1),c=n(6),u=n(2),d=n(3),g=n(4),m=n(5),v=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).toggleEdit=function(){var e=s.state.isEdited,t=s.props.message;s.setState({isEdited:!e,message:t})},s.handleEdit=function(e){s.setState({message:e.target.value})},s.handleSend=function(){var e=s.props,t=e.wsConnection,n=e.id,a=s.state.message;t.send(function(e,t){return JSON.stringify({collection:"messages",type:"mutation",query:'\n      mutation {\n        writer {\n          editMessage(id: "'.concat(e,'", message: "').concat(t,'") {\n            id\n            message\n          }\n        }\n      }\n    ')})}(n,a)),s.setState({isEdited:!1})},s.state={isEdited:!1,message:""},s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.setState({message:this.props.message})}},{key:"componentDidUpdate",value:function(e,t){e.message!==this.props.message&&this.setState({message:this.props.message})}},{key:"render",value:function(){var e=this.props,t=e.edited,n=e.date,s=this.state,i=s.message;return s.isEdited?a.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.a.createElement("div",{style:{flex:"1"}},a.a.createElement("button",{style:{backgroundColor:"red"},onClick:this.toggleEdit},"Cancel")),a.a.createElement("div",{style:{flex:"2"}},a.a.createElement("input",{value:i,onChange:this.handleEdit})),a.a.createElement("div",{style:{flex:"1"}},a.a.createElement("button",{onClick:this.handleSend},"Send"))):a.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.a.createElement("div",{style:{flex:"1"}},a.a.createElement("button",{onClick:this.toggleEdit},"Edit")),a.a.createElement("div",{style:{flex:"3",color:"#444444"}},new Date(Number(n)).toLocaleString()),a.a.createElement("div",{style:{flex:"2"}},i),a.a.createElement("div",{style:{flex:"1"}},t?"(edited)":null))}}]),n}(s.Component),f=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).wsOnConnection=function(e,t){t.send(JSON.stringify({collection:"messages",type:"subscription",query:"\n      subscription {\n        newMessageSub {\n          id\n          message\n          date\n          edited\n        }\n      }\n    "})),t.send(JSON.stringify({collection:"messages",type:"subscription",query:"\n      subscription {\n        editMessageSub {\n          id\n          message\n          edited\n        }\n      }\n    "})),t.send(JSON.stringify({collection:"messages",type:"query",query:"\n      query {\n        reader {\n          messages {\n            list {\n              id\n              message\n              date\n              edited\n            }\n          }\n        }\n      }\n    "})),t.send(JSON.stringify({collection:"users",type:"subscription",query:"\n      subscription {\n        usersStatusSub {\n          id\n          username\n          status\n        }\n      }\n    "})),t.send(JSON.stringify({collection:"users",type:"query",query:"\n      {\n        reader {\n          users {\n            list {\n              id\n              username\n              status\n            }\n          }\n        }\n      }\n    "}))},s.wsMessageReceived=function(e){console.log("got ws msg:",e);var t=JSON.parse(e.data);t.errors?console.log("got error back"):"user"===t.collection?s.updateUser(t.data):"messages"===t.collection?s.updateMessages(t.data):"users"===t.collection&&s.updateUsers(t.data)},s.updateUser=function(e){console.log("got user data:",e),s.setState({user:Object(c.a)({},e)})},s.updateMessages=function(e){var t,n,a,i;console.log(e);var o=s.state.messages;if(null===e||void 0===e||null===(t=e.reader)||void 0===t||null===(n=t.messages)||void 0===n?void 0:n.list){var u=e.reader.messages.list;s.setState({messages:Object(r.a)(u)})}else if(null===e||void 0===e||null===(a=e.newMessageSub)||void 0===a?void 0:a.message){var d=[e.newMessageSub];s.setState({messages:[].concat(Object(r.a)(o),d)})}else if(null===e||void 0===e||null===(i=e.editMessageSub)||void 0===i?void 0:i.message){var g=Object(r.a)(o),m=g.findIndex((function(t){return t.id===e.editMessageSub.id})),v=e.editMessageSub,f=(v.id,Object(l.a)(v,["id"]));g[m]=Object(c.a)({},g[m],{},f),s.setState({messages:Object(r.a)(g)})}},s.handleEditNewMessage=function(e){s.setState({newMessage:e.target.value})},s.handleSendNewMessage=function(){var e,t=s.state,n=t.wsConnection,a=t.newMessage;n.send((e=a,JSON.stringify({collection:"messages",type:"mutation",query:'\n      mutation {\n        writer {\n          addMessage(message: "'.concat(e,'") {\n            message\n          }\n        }\n      }\n    ')}))),s.setState({newMessage:""})},s.handleLeave=function(){s.state.wsConnection.send(JSON.stringify({close:!0,subName:"newMessage"}))},s.updateUsers=function(e){var t,n,a;console.log(e);var i=s.state.users;if(null===e||void 0===e||null===(t=e.reader)||void 0===t||null===(n=t.users)||void 0===n?void 0:n.list){var o=e.reader.users.list;s.setState({users:[].concat(Object(r.a)(i),Object(r.a)(o))})}else if(null===e||void 0===e||null===(a=e.usersStatusSub)||void 0===a?void 0:a.id){var l=i.map((function(t){return t.id===e.usersStatusSub.id?e.usersStatusSub:t}));s.setState({users:Object(r.a)(l)})}},s.state={messages:[],newMessage:"",users:[],user:{},wsConnection:null},s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=new WebSocket("ws://localhost:3000/subscriptions");t.onopen=function(n){return e.wsOnConnection(n,t)},t.onmessage=this.wsMessageReceived,t.onclose=function(){console.log("connection closed")},this.setState({wsConnection:t})}},{key:"render",value:function(){var e=this.state,t=e.messages,n=e.newMessage,s=e.users,i=e.user,o=e.wsConnection;return a.a.createElement("div",{style:{display:"flex"}},(null===i||void 0===i?void 0:i.connectionId)?a.a.createElement("div",null,"user connection - ",i.connectionId):null,a.a.createElement("div",{style:{flex:"1"}},s.map((function(e){return a.a.createElement("p",{key:e.id,style:{color:"online"===e.status?"green":"black"}},e.username)}))),a.a.createElement("div",{style:{flex:"3"}},t.map((function(e){return a.a.createElement(v,Object.assign({key:e.id},e,{wsConnection:o}))})),a.a.createElement("div",null,a.a.createElement("input",{value:n,onChange:this.handleEditNewMessage}),a.a.createElement("button",{onClick:this.handleSendNewMessage,style:{backgroundColor:o?"green":"red"}},"click")),a.a.createElement("div",null,a.a.createElement("button",{onClick:this.handleLeave,style:{backgroundColor:o?"green":"red"}},"leave"))))}}]),n}(s.Component);var p=function(){return a.a.createElement("div",null,"Welcome",a.a.createElement(f,null))};o.a.render(a.a.createElement(p,null),document.getElementById("root"))}},[[10,1,2]]]);
//# sourceMappingURL=main.1bc5866c.chunk.js.map